{% extends 'layout_navbar.html' %}
{% load static %}

{% block page_title %}Profil {{ profile_user.username }}{% endblock page_title %}

{% block main_content %}
<div class="max-w-2xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200">
    <div class="flex flex-col items-center">
        <img class="w-64 h-64 rounded-full border-4 border-custom-blue-100 object-cover"
            src="{{ profile.profile_picture_url_or_default }}"
            data-default-src="{% static 'images/default_avatar.png' %}"
            onerror="this.onerror=null; this.src=this.dataset.defaultSrc;"
            alt="Foto profil {{ profile_user.username }}">

        <h1 class="text-3xl font-bold text-custom-blue-400 mt-4">{{ profile_user.username }}</h1>
        <span class="mt-1 text-sm font-medium bg-custom-blue-100 text-custom-blue-400 px-3 py-1 rounded-full">
            {{ profile.get_role_display }}
        </span>

        <p class="text-gray-600 text-center mt-4">
            {{ profile.bio|default:"User ini belum menulis bio." }}
        </p>

        {% if user.is_authenticated %}
        {% if user == profile_user %}
        <a href="{% url 'main:edit_my_profile' %}"
            class="mt-6 w-full max-w-xs text-center bg-custom-blue-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-custom-blue-300 focus:outline-none focus:ring-2 focus:ring-custom-blue-200 transition duration-150 ease-in-out">
            Edit Profil
        </a>
        {% elif user.is_superuser %}
        <a href="{% url 'main:edit_user_profile' username=profile_user.username %}"
            class="mt-6 w-full max-w-xs text-center bg-custom-blue-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-custom-blue-300 focus:outline-none focus:ring-2 focus:ring-custom-blue-200 transition duration-150 ease-in-out">
            Edit Profil (sebagai Admin)
        </a>
        {% endif %}
        {% endif %}
    </div>

    <hr class="my-8">

    <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Tim yang Diikuti</h2>
        {% if user_teams %}
        <ul class="space-y-2">
            {% for team in user_teams %}
            <li class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                {# Tampilkan logo tim jika ada, jika tidak pakai placeholder #}
                {% if team.logo %}
                <img src="{{ team.logo }}" alt="Logo {{ team.name}}"
                    class="w-10 h-10 rounded-full object-cover border border-gray-200">
                {% else %}
                <img src="https://img.icons8.com/?size=100&id=uMMzE4KzgxCO&format=png&color=000000"
                    alt="Logo {{ team.name }}" class="w-10 h-10 rounded-full object-cover border border-gray-200">
                {% endif %}
                <span class="font-medium text-gray-700">{{ team.name }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-gray-500 italic">Pengguna ini belum bergabung dengan tim manapun.</p>
        {% endif %}
    </div>
    <div>
        <h2 class="text-xl font-bold text-gray-800 mb-4">Histori & Statistik Prediksi</h2>
        <div class="bg-custom-blue-50 p-4 rounded-lg mb-4">
            <p class="text-lg font-semibold text-custom-blue-400">Total Poin: {{ total_prediction_points }}</p>
        </div>

        {% if user_predictions %}
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Prediksi Terakhir:</h3>
        <ul class="space-y-3">
            {# Tampilkan beberapa prediksi terakhir, misal 5 #}
            {% for prediction in user_predictions|slice:":5" %}
            <li class="border border-gray-200 p-3 rounded-lg shadow-sm">
                <p class="text-sm text-gray-500">{{ prediction.created_at|date:"d M Y, H:i" }}</p>
                <p class="font-medium">
                    Pertandingan: <span class="text-gray-700">{{ prediction.match }}</span>
                </p>
                <p>
                    Prediksi Menang:
                    <span class="font-semibold text-custom-blue-400">{{ prediction.predicted_winner.name }}</span>
                </p>
                <p>
                    Poin Didapat:
                    <span
                        class="font-semibold {% if prediction.points_awarded > 0 %}text-green-600{% else %}text-gray-500{% endif %}">
                        {{ prediction.points_awarded }}
                    </span>
                </p>
            </li>
            {% empty %}
            <p class="text-gray-500 italic">Belum ada data prediksi.</p>
            {% endfor %}
        </ul>
        {# {% if user_predictions|length > 5 %} #}
        {# <a href="#" class="text-custom-blue-400 hover:underline mt-4 inline-block">Lihat Semua Prediksi</a> #}
        {# {% endif %} #}
        {% else %}
        <p class="text-gray-500 italic">Pengguna ini belum membuat prediksi apapun.</p>
        {% endif %}
    </div>
</div>
{% endblock main_content %}